<!-- Loading state -->
<mat-card *ngIf="loading">
  <mat-card-content class="ams">
    <p>Loading spool data...</p>
  </mat-card-content>
</mat-card>

<!-- Error state -->
<mat-card *ngIf="error" class="error-card">
  <mat-card-content class="ams">
    <p class="error-message">{{ error }}</p>
    <button mat-raised-button color="primary" routerLink="/">Go Home</button>
  </mat-card-content>
</mat-card>

<!-- Spool info -->
<mat-card *ngIf="!loading && !error && spool">
  <mat-card-content class="ams">
    <app-spool-item [spool]="spool"></app-spool-item>
  </mat-card-content>
</mat-card>

<!-- Tray selection -->
<mat-card class="ams-card" *ngIf="!loading && !error && spool">
  <mat-card-header>
    <mat-card-title>
      <h1>Select a tray</h1>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content class="ams">
    <p *ngIf="updating" class="updating-message">Updating tray...</p>

    <div class="ams-container">
      <ng-container *ngIf="amsEntities.length > 0; else noAmsMessage">
        @for (ams of amsEntities; track ams; let index = $index) {

        <mat-card class="ams-card">
          <mat-card-header>
            <mat-card-title>AMS {{ index + 1 }}</mat-card-title>
          </mat-card-header>
          <mat-card-content class="ams-card-content">
            @for (tray of ams.trays; track tray; let trayIndex = $index) {

            <button
              mat-raised-button
              color="primary"
              (click)="updateTray(tray)"
              [disabled]="updating"
            >
              <span>Tray {{ trayIndex + 1 }}</span>
            </button>
            }
          </mat-card-content>
        </mat-card>

        }
      </ng-container>

      <ng-template #noAmsMessage>
        <p>No AMS found</p>
      </ng-template>

      <ng-container *ngIf="externalSpoolEntity?.id">
        <mat-card class="ams-card">
          <mat-card-header>
            <mat-card-title>External Spool</mat-card-title>
          </mat-card-header>
          <mat-card-content class="ams-card-content">
            <button mat-raised-button color="primary" (click)="updateTray(externalSpoolEntity)" [disabled]="updating">
              <span>External Spool</span>
            </button>
          </mat-card-content>
        </mat-card>
      </ng-container>

      <ng-template #noExternalSpoolMessage>
        <p>No External Spool found</p>
      </ng-template>
    </div>
  </mat-card-content>
</mat-card>
